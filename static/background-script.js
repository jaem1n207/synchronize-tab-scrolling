"use strict";(()=>{chrome.runtime.onMessage.addListener((r,c,o)=>{if(r.command==="getSyncTabIds")return chrome.storage.sync.get(["syncTabIds"],e=>{chrome.runtime.lastError?o(chrome.runtime.lastError):o(e.syncTabIds||[])}),!0;if(r.command==="setSyncTabIds"){let{syncTabIds:e}=r.data;return chrome.storage.sync.set({syncTabIds:e},()=>{chrome.runtime.lastError?o(chrome.runtime.lastError):o()}),!0}if(r.command==="startSync"&&(r.data||[]).forEach(s=>{chrome.tabs.get(s,()=>{if(chrome.runtime.lastError){console.error(`Error in chrome.tabs.get: ${chrome.runtime.lastError}`);return}chrome.scripting.executeScript({target:{tabId:s},files:["src/pages/content/index.js"]},()=>{if(chrome.runtime.lastError){console.error(`Error in chrome.scripting.executeScript: ${chrome.runtime.lastError.message}`);return}chrome.tabs.sendMessage(s,{command:"startSyncTab",data:s}),console.debug("Sent startSyncTab message to tab",s,"with data",s)})})}),r.command==="stopSync"){let e=r.data||[];e.length&&e.forEach(s=>{chrome.tabs.sendMessage(s,{command:"stopSyncTab",data:s})})}if(r.command==="syncScroll"){let e=c.tab?.id,{scrollYPercentage:s}=r.data;if(console.debug("Received syncScroll message from tab",c.tab?.id,"with data",r.data),!e)return;chrome.storage.sync.get(["syncTabIds"],a=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{let{syncTabIds:t}=a;if(!t)return;if(t.length&&t.includes(e))for(let n of t)n!==e&&(console.debug("Sending syncScrollForTab message to tab",n),chrome.tabs.sendMessage(n,{command:"syncScrollForTab",data:{scrollYPercentage:s}}))}})}});var m=r=>{chrome.storage.sync.get(["syncTabIds"],c=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{let{syncTabIds:o}=c;if(!o||o?.length===0)return;o.length&&o.includes(r)&&chrome.storage.sync.set({syncTabIds:[]},()=>{chrome.runtime.lastError&&console.error(chrome.runtime.lastError)})}})};chrome.tabs.onUpdated.addListener((r,c)=>{c.status==="complete"&&chrome.storage.sync.get(["syncTabIds"],o=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{let{syncTabIds:e}=o;if(!e||e?.length===0)return;e.length&&e.includes(r)&&chrome.tabs.sendMessage(r,{command:"startSyncTab",data:r})}})});chrome.tabs.onRemoved.addListener(r=>{m(r)});})();
