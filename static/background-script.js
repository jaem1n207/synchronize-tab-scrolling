chrome.runtime.onMessage.addListener((m,C,v)=>{if(m.command==="getSyncTabIds")return chrome.storage.sync.get(["syncTabIds"],(i)=>{if(chrome.runtime.lastError)v(chrome.runtime.lastError);else v(i.syncTabIds||[])}),!0;if(m.command==="setSyncTabIds"){const{syncTabIds:i}=m.data;return chrome.storage.sync.set({syncTabIds:i},()=>{if(chrome.runtime.lastError)v(chrome.runtime.lastError);else v()}),!0}if(m.command==="startSync"){const i=m.data||[];for(let h of i)chrome.tabs.get(h,()=>{if(chrome.runtime.lastError){console.error(`Error in chrome.tabs.get: ${chrome.runtime.lastError}`);return}chrome.scripting.executeScript({target:{tabId:h},files:["content-script.js"]},()=>{if(chrome.runtime.lastError){console.error(`Error in chrome.scripting.executeScript: ${chrome.runtime.lastError.message}`);return}chrome.tabs.sendMessage(h,{command:"startSyncTab",data:h}),console.debug("Sent startSyncTab message to tab",h,"with data",h)})})}if(m.command==="stopSync"){const i=m.data||[];if(i.length)for(let h of i)chrome.tabs.sendMessage(h,{command:"stopSyncTab",data:h})}if(m.command==="syncScroll"){const i=C.tab?.id,{scrollYPercentage:h}=m.data;if(console.debug("Received syncScroll message from tab",C.tab?.id,"with data",m.data),!i)return;chrome.storage.sync.get(["syncTabIds"],(j)=>{if(console.log("\uD83D\uDE80 ~ chrome.storage.sync.get ~ result:",j),chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:E}=j;if(!E)return;if(E.length&&E.includes(i)){for(let g of E)if(g!==i)console.debug("Sending syncScrollForTab message to tab",g),chrome.tabs.sendMessage(g,{command:"syncScrollForTab",data:{scrollYPercentage:h}})}}})}});var w=(m)=>{chrome.storage.sync.get(["syncTabIds"],(C)=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:v}=C;if(!v||v?.length===0)return;if(v.length&&v.includes(m))chrome.storage.sync.set({syncTabIds:[]},()=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError)})}})};chrome.tabs.onUpdated.addListener((m,C)=>{if(C.status==="complete")chrome.storage.sync.get(["syncTabIds"],(v)=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:i}=v;if(!i||i?.length===0)return;if(i.length&&i.includes(m))chrome.tabs.sendMessage(m,{command:"startSyncTab",data:m})}})});chrome.tabs.onRemoved.addListener((m)=>{w(m)});
