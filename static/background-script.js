chrome.runtime.onMessage.addListener((i,f,A)=>{if(i.command==="getSyncTabIds")return chrome.storage.sync.get(["syncTabIds"],(m)=>{if(chrome.runtime.lastError)A(chrome.runtime.lastError);else A(m.syncTabIds||[])}),!0;if(i.command==="setSyncTabIds"){const{syncTabIds:m}=i.data;return chrome.storage.sync.set({syncTabIds:m},()=>{if(chrome.runtime.lastError)A(chrome.runtime.lastError);else A()}),!0}if(i.command==="startSync")(i.data||[]).forEach((E)=>{chrome.tabs.get(E,()=>{if(chrome.runtime.lastError){console.error(`Error in chrome.tabs.get: ${chrome.runtime.lastError}`);return}chrome.scripting.executeScript({target:{tabId:E},files:["content-script.js"]},()=>{if(chrome.runtime.lastError){console.error(`Error in chrome.scripting.executeScript: ${chrome.runtime.lastError.message}`);return}chrome.tabs.sendMessage(E,{command:"startSyncTab",data:E}),console.debug("Sent startSyncTab message to tab",E,"with data",E)})})});if(i.command==="stopSync"){const m=i.data||[];if(m.length)m.forEach((E)=>{chrome.tabs.sendMessage(E,{command:"stopSyncTab",data:E})})}if(i.command==="syncScroll"){const m=f.tab?.id,{scrollYPercentage:E}=i.data;if(console.debug("Received syncScroll message from tab",f.tab?.id,"with data",i.data),!m)return;chrome.storage.sync.get(["syncTabIds"],(w)=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:j}=w;if(!j)return;if(j.length&&j.includes(m)){for(let v of j)if(v!==m)console.debug("Sending syncScrollForTab message to tab",v),chrome.tabs.sendMessage(v,{command:"syncScrollForTab",data:{scrollYPercentage:E}})}}})}});var x=(i)=>{chrome.storage.sync.get(["syncTabIds"],(f)=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:A}=f;if(!A||A?.length===0)return;if(A.length&&A.includes(i))chrome.storage.sync.set({syncTabIds:[]},()=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError)})}})};chrome.tabs.onUpdated.addListener((i,f)=>{if(f.status==="complete")chrome.storage.sync.get(["syncTabIds"],(A)=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:m}=A;if(!m||m?.length===0)return;if(m.length&&m.includes(i))chrome.tabs.sendMessage(i,{command:"startSyncTab",data:i})}})});chrome.tabs.onRemoved.addListener((i)=>{x(i)});
