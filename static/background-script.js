"use strict";(()=>{var l=typeof navigator!="undefined",t=l?navigator.userAgentData&&Array.isArray(navigator.userAgentData.brands)?navigator.userAgentData.brands.map(r=>`${r.brand.toLowerCase()} ${r.version}`).join(" "):navigator.userAgent.toLowerCase():"some useragent",u=l?navigator.userAgentData&&typeof navigator.userAgentData.platform=="string"?navigator.userAgentData.platform.toLowerCase():navigator.platform.toLowerCase():"some platform",c=t.includes("chrome")||t.includes("chromium"),f=t.includes("firefox")||t.includes("thunderbird")||t.includes("librewolf"),p=c&&t.includes("vivaldi"),y=c&&t.includes("yabrowser"),x=c&&(t.includes("opr")||t.includes("opera")),S=c&&t.includes("edg"),v=!c&&t.includes("safari"),E=u.startsWith("win"),T=u.startsWith("mac"),A=l&&navigator.userAgentData?navigator.userAgentData.mobile:t.includes("mobile"),b=(()=>{let r=t.match(/(?:firefox|librewolf)(?:\/| )([^ ]+)/);return r&&r[1]?r[1]:""})();chrome.runtime.onMessage.addListener((r,n,e)=>{var s,d;if(r.command==="getSyncTabIds")return chrome.storage.local.get(["syncTabIds"],o=>{if(chrome.runtime.lastError){e(chrome.runtime.lastError);return}e(o.syncTabIds||[])}),!0;if(r.command==="setSyncTabIds"){let{syncTabIds:o}=r.data;return chrome.storage.local.set({syncTabIds:o},()=>{if(chrome.runtime.lastError){e(chrome.runtime.lastError);return}e()}),!0}if(r.command==="startSync"){let o=r.data||[];for(let a of o)chrome.tabs.get(a,()=>{if(chrome.runtime.lastError){console.error(`Error in chrome.tabs.get: ${chrome.runtime.lastError}`);return}if(!(f?b>="102.0":!0)){console.error("scripting.executeScript is not supported in this version of Firefox");return}chrome.scripting.executeScript({target:{tabId:a},files:["content-script.js"]},()=>{if(chrome.runtime.lastError){console.error(`Error in chrome.scripting.executeScript: ${chrome.runtime.lastError.message}`);return}chrome.tabs.sendMessage(a,{command:"startSyncTab",data:a}),console.debug("Sent startSyncTab message to tab",a,"with data",a)})})}if(r.command==="stopSync"){let o=r.data||[];if(o.length)for(let a of o)chrome.tabs.sendMessage(a,{command:"stopSyncTab",data:a})}if(r.command==="syncScroll"){let o=(s=n.tab)==null?void 0:s.id,{scrollYPercentage:a}=r.data;if(console.debug("Received syncScroll message from tab",(d=n.tab)==null?void 0:d.id,"with data",r.data),!o)return;chrome.storage.local.get(["syncTabIds"],g=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{let{syncTabIds:i}=g;if(!i)return;if(i.length&&i.includes(o))for(let m of i)m!==o&&(console.debug("Sending syncScrollForTab message to tab",m),chrome.tabs.sendMessage(m,{command:"syncScrollForTab",data:{scrollYPercentage:a}}))}})}});var h=r=>{chrome.storage.local.get(["syncTabIds"],n=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{let{syncTabIds:e}=n;if(!e||(e==null?void 0:e.length)===0)return;e.length&&e.includes(r)&&chrome.storage.local.set({syncTabIds:[]},()=>{chrome.runtime.lastError&&console.error(chrome.runtime.lastError)})}})};chrome.tabs.onUpdated.addListener((r,n)=>{n.status==="complete"&&chrome.storage.local.get(["syncTabIds"],e=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{let{syncTabIds:s}=e;if(!s||(s==null?void 0:s.length)===0)return;s.length&&s.includes(r)&&chrome.tabs.sendMessage(r,{command:"startSyncTab",data:r})}})});chrome.tabs.onRemoved.addListener(r=>{h(r)});})();
