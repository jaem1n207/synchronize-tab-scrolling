chrome.runtime.onMessage.addListener((m,j,f)=>{if(m.command==="getSyncTabIds")return chrome.storage.local.get(["syncTabIds"],(i)=>{if(chrome.runtime.lastError){f(chrome.runtime.lastError);return}f(i.syncTabIds||[])}),!0;if(m.command==="setSyncTabIds"){const{syncTabIds:i}=m.data;return chrome.storage.local.set({syncTabIds:i},()=>{if(chrome.runtime.lastError){f(chrome.runtime.lastError);return}f()}),!0}if(m.command==="startSync"){const i=m.data||[];for(let E of i)chrome.tabs.get(E,()=>{if(chrome.runtime.lastError){console.error(`Error in chrome.tabs.get: ${chrome.runtime.lastError}`);return}chrome.scripting.executeScript({target:{tabId:E},files:["content-script.js"]},()=>{if(chrome.runtime.lastError){console.error(`Error in chrome.scripting.executeScript: ${chrome.runtime.lastError.message}`);return}chrome.tabs.sendMessage(E,{command:"startSyncTab",data:E}),console.debug("Sent startSyncTab message to tab",E,"with data",E)})})}if(m.command==="stopSync"){const i=m.data||[];if(i.length)for(let E of i)chrome.tabs.sendMessage(E,{command:"stopSyncTab",data:E})}if(m.command==="syncScroll"){const i=j.tab?.id,{scrollYPercentage:E}=m.data;if(console.debug("Received syncScroll message from tab",j.tab?.id,"with data",m.data),!i)return;chrome.storage.local.get(["syncTabIds"],(x)=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:v}=x;if(!v)return;if(v.length&&v.includes(i)){for(let w of v)if(w!==i)console.debug("Sending syncScrollForTab message to tab",w),chrome.tabs.sendMessage(w,{command:"syncScrollForTab",data:{scrollYPercentage:E}})}}})}});var z=(m)=>{chrome.storage.local.get(["syncTabIds"],(j)=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:f}=j;if(!f||f?.length===0)return;if(f.length&&f.includes(m))chrome.storage.local.set({syncTabIds:[]},()=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError)})}})};chrome.tabs.onUpdated.addListener((m,j)=>{if(j.status==="complete")chrome.storage.local.get(["syncTabIds"],(f)=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:i}=f;if(!i||i?.length===0)return;if(i.length&&i.includes(m))chrome.tabs.sendMessage(m,{command:"startSyncTab",data:m})}})});chrome.tabs.onRemoved.addListener((m)=>{z(m)});
