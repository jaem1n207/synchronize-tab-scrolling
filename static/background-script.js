chrome.runtime.onMessage.addListener((i,f,E)=>{if(i.command==="getSyncTabIds")return chrome.storage.sync.get(["syncTabIds"],(m)=>{if(chrome.runtime.lastError){E(chrome.runtime.lastError);return}E(m.syncTabIds||[])}),!0;if(i.command==="setSyncTabIds"){const{syncTabIds:m}=i.data;return chrome.storage.sync.set({syncTabIds:m},()=>{if(chrome.runtime.lastError){E(chrome.runtime.lastError);return}E()}),!0}if(i.command==="startSync"){const m=i.data||[];for(let w of m)chrome.tabs.get(w,()=>{if(chrome.runtime.lastError){console.error(`Error in chrome.tabs.get: ${chrome.runtime.lastError}`);return}chrome.scripting.executeScript({target:{tabId:w},files:["content-script.js"]},()=>{if(chrome.runtime.lastError){console.error(`Error in chrome.scripting.executeScript: ${chrome.runtime.lastError.message}`);return}chrome.tabs.sendMessage(w,{command:"startSyncTab",data:w}),console.debug("Sent startSyncTab message to tab",w,"with data",w)})})}if(i.command==="stopSync"){const m=i.data||[];if(m.length)for(let w of m)chrome.tabs.sendMessage(w,{command:"stopSyncTab",data:w})}if(i.command==="syncScroll"){const m=f.tab?.id,{scrollYPercentage:w}=i.data;if(console.debug("Received syncScroll message from tab",f.tab?.id,"with data",i.data),!m)return;chrome.storage.sync.get(["syncTabIds"],(x)=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:j}=x;if(!j)return;if(j.length&&j.includes(m)){for(let v of j)if(v!==m)console.debug("Sending syncScrollForTab message to tab",v),chrome.tabs.sendMessage(v,{command:"syncScrollForTab",data:{scrollYPercentage:w}})}}})}});var z=(i)=>{chrome.storage.sync.get(["syncTabIds"],(f)=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:E}=f;if(!E||E?.length===0)return;if(E.length&&E.includes(i))chrome.storage.sync.set({syncTabIds:[]},()=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError)})}})};chrome.tabs.onUpdated.addListener((i,f)=>{if(f.status==="complete")chrome.storage.sync.get(["syncTabIds"],(E)=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:m}=E;if(!m||m?.length===0)return;if(m.length&&m.includes(i))chrome.tabs.sendMessage(i,{command:"startSyncTab",data:i})}})});chrome.tabs.onRemoved.addListener((i)=>{z(i)});
