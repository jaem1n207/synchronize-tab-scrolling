chrome.runtime.onMessage.addListener((i,w,g)=>{if(i.command==="getSyncTabIds")return chrome.storage.sync.get(["syncTabIds"],(m)=>{if(chrome.runtime.lastError)g(chrome.runtime.lastError);else g(m.syncTabIds||[])}),!0;if(i.command==="setSyncTabIds"){const{syncTabIds:m}=i.data;return chrome.storage.sync.set({syncTabIds:m},()=>{if(chrome.runtime.lastError)g(chrome.runtime.lastError);else g()}),!0}if(i.command==="startSync")(i.data||[]).forEach((v)=>{chrome.tabs.get(v,()=>{if(chrome.runtime.lastError){console.error(`Error in chrome.tabs.get: ${chrome.runtime.lastError}`);return}chrome.scripting.executeScript({target:{tabId:v},files:["src/pages/content/index.js"]},()=>{if(chrome.runtime.lastError){console.error(`Error in chrome.scripting.executeScript: ${chrome.runtime.lastError.message}`);return}chrome.tabs.sendMessage(v,{command:"startSyncTab",data:v}),console.debug("Sent startSyncTab message to tab",v,"with data",v)})})});if(i.command==="stopSync"){const m=i.data||[];if(m.length)m.forEach((v)=>{chrome.tabs.sendMessage(v,{command:"stopSyncTab",data:v})})}if(i.command==="syncScroll"){const m=w.tab?.id,{scrollYPercentage:v}=i.data;if(console.debug("Received syncScroll message from tab",w.tab?.id,"with data",i.data),!m)return;chrome.storage.sync.get(["syncTabIds"],(f)=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:E}=f;if(!E)return;if(E.length&&E.includes(m)){for(let M of E)if(M!==m)console.debug("Sending syncScrollForTab message to tab",M),chrome.tabs.sendMessage(M,{command:"syncScrollForTab",data:{scrollYPercentage:v}})}}})}});var j=(i)=>{chrome.storage.sync.get(["syncTabIds"],(w)=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:g}=w;if(!g||g?.length===0)return;if(g.length&&g.includes(i))chrome.storage.sync.set({syncTabIds:[]},()=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError)})}})};chrome.tabs.onUpdated.addListener((i,w)=>{if(w.status==="complete")chrome.storage.sync.get(["syncTabIds"],(g)=>{if(chrome.runtime.lastError)console.error(chrome.runtime.lastError);else{const{syncTabIds:m}=g;if(!m||m?.length===0)return;if(m.length&&m.includes(i))chrome.tabs.sendMessage(i,{command:"startSyncTab",data:i})}})});chrome.tabs.onRemoved.addListener((i)=>{j(i)});
