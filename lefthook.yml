pre-commit:
  parallel: true
  commands:
    lint-and-format-ts:
      glob: '**/*.{ts,tsx}'
      exclude: '{node_modules,extension/dist,build,dist}/**/*'
      run: |
        bun x prettier --write {staged_files} &&
        NODE_OPTIONS='--experimental-strip-types' bun x eslint {staged_files} --fix --flag unstable_native_nodejs_ts_config --max-warnings=0
    format-others:
      glob: '**/*.{json,md,mdx,css,html,yml,yaml,scss}'
      exclude: '{node_modules,extension/dist,build,dist,pnpm-lock.yaml}/**/*'
      run: bun x prettier --write {staged_files}
    typecheck:
      glob: '**/*.{ts,tsx}'
      exclude: '{node_modules,extension/dist,build,dist}/**/*'
      run: bun x tsc --noEmit

# 종속성 변경 시 패키지 업데이트
post-merge:
  commands:
    install-deps:
      run: |
        if git diff --name-only HEAD@{1} HEAD | grep -q "package.json\|pnpm-lock.yaml"; then
          echo "Dependencies changed, running pnpm install..."
          pnpm install
        fi

# 수동 실행용 헬스체크
health:
  parallel: true
  commands:
    lint:
      run: NODE_OPTIONS='--experimental-strip-types' bun x eslint . --fix --flag unstable_native_nodejs_ts_config
    format:
      run: bun x prettier --write .
    typecheck:
      run: bun x tsc --noEmit
